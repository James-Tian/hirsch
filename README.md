# Hirsch - A python binding to the MvTec HALCON library

* Author: Dov Grobgeld <dov.grobgeldr@gmail.com>
* Created: 2013-12-14 Sat
* Keywords: Python, Halcon
* URL: <http://github.com/dov/hirsch>
* Version: 0.1

# Description

Hirsch is a python binding to the MVTec proprietory image processing 
library HALCON, see: http://www.halcon.com/ . It has currently been tested with HALCON version 9.0 . 

Note about the name. Since HALCON is a proprietary name belonging to MVTec, I have decided to name this binding Hirsch. 

# Licence

The use of Hirsch requires a licence to the HALCON library. Please refer to the HALCON End User Legal Agreement (EULA) for details.

The licence of the Python binding is LGPL3 and of the automatic python generator, GPL3.

See license.md for license details about Hirsch.


# Building

There are two steps concerning building the Hirsch binding:

## Creating python binding code

This step parses the Halcon include files and generates python binding. It is run by doing:

    python h-parse.py
    
Note that you will need to edit h-parse.py to set the halcon include directory at the top of the files.

This distribution contains pregenerated bindings for halcon version 9, so this step may be skipped.

## Compiling the python binding

Please edit setup.py to specify include and library paths for halcon. Install as standard python modules:

    python setup.py install 

# Testing

Here is an example of how to use Hirsch:

    from hirsch import HImage, HDataCode2D
    
    Filename = 'qr.tiff'
    img = HImage.ReadImage(Filename)
    print "Image size=", img.Width(), img.Height()
    
    QrDetector = HDataCode2D("QR Code","default_parameters","enhanced_recognition")
    QRContours,Handles,DataStrings = QrDetector.FindDataCode2d(img,"stop_after_result_num",1)
    print DataStrings

A few more examples are available in examples.

# Interface with giv

No effort has been made yet to do bindings for the built in visualization. Instead the library hirsch.giv provides a simple interface for using my image viewer giv for visualization, see: http://giv.sourceforge.net/giv/index.html .

Here is an example of how to view blobs with blob info with giv.

    from hirsch import HImage, HDataCode2D
    import hirsch.giv as giv
    
    Filename = 'qrfoo.tif'
    img = HImage.ReadImage(Filename)
    blobs = img.Threshold(0,128).Connection().ErosionCircle(3)
    
    blobs = [b for b in blobs if b.Circularity() > 0.5]
    
    giv.ViewRegions(blobs,image=img, props=['Circularity','Area'])

Here is the resulting giv image:

![QR blob detection](qrblobexample.png?raw=true)

When hovering over the red blobs, the Circularity and the Area properties for those blobs are shown.
                
# Implementation notes

The autogenerated codes resides in .i files. There are two such files for each Hirsch class. One containing the "list" code that define the mapping between python method names, the c-function implementation, and its documentation. The second contains the implementation of the c-functions.

I have tried to make the binding as pythonesue as possible. This means that I have tried to use python structures as much as possible. E.g. for functions taking both HTuple and pod (plain old data) as input, the HTuple versions were skipped. 

One problem that I have not satisfactory solved are functions that return scalars by HTuple's. There is no indication in the header files that the returned value is a scalar and not an arbitrary length array. In these cases I return a Python Tuple as a return value and the user must dereference it.

I have succesfully taken care of operator overloading.
    
